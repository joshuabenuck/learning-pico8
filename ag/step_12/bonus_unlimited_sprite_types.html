<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Bonus Step: Unlimited Sprite Types</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/custom.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../overview/overview.html">Overview</a></li><li class="chapter-item expanded "><a href="../../community/intro.html"><strong aria-hidden="true">1.</strong> The Community</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../community/splore.html"><strong aria-hidden="true">1.1.</strong> Splore</a></li></ol></li><li class="chapter-item expanded "><a href="../../using/intro.html"><strong aria-hidden="true">2.</strong> Using PICO-8</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../using/limitations.html"><strong aria-hidden="true">2.1.</strong> Limitations</a></li><li class="chapter-item expanded "><a href="../../using/code_editor.html"><strong aria-hidden="true">2.2.</strong> Code Editor</a></li><li class="chapter-item expanded "><a href="../../using/sprite_editor.html"><strong aria-hidden="true">2.3.</strong> Sprite Editor</a></li><li class="chapter-item expanded "><a href="../../using/map_editor.html"><strong aria-hidden="true">2.4.</strong> Map Editor</a></li><li class="chapter-item expanded "><a href="../../using/sound_editor.html"><strong aria-hidden="true">2.5.</strong> Sound Editor</a></li><li class="chapter-item expanded "><a href="../../using/music_editor.html"><strong aria-hidden="true">2.6.</strong> Music Editor</a></li><li class="chapter-item expanded "><a href="../../using/coordinates.html"><strong aria-hidden="true">2.7.</strong> Coordinates</a></li><li class="chapter-item expanded "><a href="../../using/programming_basics.html"><strong aria-hidden="true">2.8.</strong> Programming Basics</a></li><li class="chapter-item expanded "><a href="../../using/the_game_loop.html"><strong aria-hidden="true">2.9.</strong> The Game Loop</a></li></ol></li><li class="chapter-item expanded "><a href="../../ag/intro/ag_tutorial.html"><strong aria-hidden="true">3.</strong> Adventure Game Tutorial</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../ag/step_01/the_map.html"><strong aria-hidden="true">3.1.</strong> The Map</a></li><li class="chapter-item expanded "><a href="../../ag/step_02/the_player.html"><strong aria-hidden="true">3.2.</strong> The Player</a></li><li class="chapter-item expanded "><a href="../../ag/step_03/movement.html"><strong aria-hidden="true">3.3.</strong> Movement</a></li><li class="chapter-item expanded "><a href="../../ag/step_04/camera.html"><strong aria-hidden="true">3.4.</strong> Camera</a></li><li class="chapter-item expanded "><a href="../../ag/step_05/keys.html"><strong aria-hidden="true">3.5.</strong> Keys</a></li><li class="chapter-item expanded "><a href="../../ag/step_06/inventory.html"><strong aria-hidden="true">3.6.</strong> Inventory</a></li><li class="chapter-item expanded "><a href="../../ag/step_07/doors.html"><strong aria-hidden="true">3.7.</strong> Doors</a></li><li class="chapter-item expanded "><a href="../../ag/step_08/animated_tiles.html"><strong aria-hidden="true">3.8.</strong> Animate Tiles</a></li><li class="chapter-item expanded "><a href="../../ag/step_09/winning_and_losing.html"><strong aria-hidden="true">3.9.</strong> Winning and Losing</a></li><li class="chapter-item expanded "><a href="../../ag/step_10/trying_again.html"><strong aria-hidden="true">3.10.</strong> Trying Again</a></li><li class="chapter-item expanded "><a href="../../ag/step_11/bonus_adding_text.html"><strong aria-hidden="true">3.11.</strong> Bonus Step: Adding Text</a></li><li class="chapter-item expanded "><a href="../../ag/step_12/bonus_unlimited_sprite_types.html" class="active"><strong aria-hidden="true">3.12.</strong> Bonus Step: Unlimited Sprite Types</a></li></ol></li><li class="chapter-item expanded "><a href="../../ss/intro/intro.html"><strong aria-hidden="true">4.</strong> A Space Shooter in 16 Steps</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../ss/step_01/draw_ship.html"><strong aria-hidden="true">4.1.</strong> Draw Ship on Screen</a></li><li class="chapter-item expanded "><a href="../../ss/step_02/animate_propulsion.html"><strong aria-hidden="true">4.2.</strong> Animate Propulsion</a></li><li class="chapter-item expanded "><a href="../../ss/step_03/ship_movement.html"><strong aria-hidden="true">4.3.</strong> Basic Ship Movement</a></li><li class="chapter-item expanded "><a href="../../ss/step_04/fire_bullets.html"><strong aria-hidden="true">4.4.</strong> Fire Laser Bullets</a></li><li class="chapter-item expanded "><a href="../../ss/step_05/remove_bullets.html"><strong aria-hidden="true">4.5.</strong> Remove Bullets</a></li><li class="chapter-item expanded "><a href="../../ss/step_06/draw_enemies.html"><strong aria-hidden="true">4.6.</strong> Draw Enemies</a></li><li class="chapter-item expanded "><a href="../../ss/step_07/move_enemies.html"><strong aria-hidden="true">4.7.</strong> Move Enemies</a></li><li class="chapter-item expanded "><a href="../../ss/step_08/points_and_health.html"><strong aria-hidden="true">4.8.</strong> Points and Health</a></li><li class="chapter-item expanded "><a href="../../ss/step_09/cleanup_and_prep.html"><strong aria-hidden="true">4.9.</strong> Collision 1: Cleanup and Prep</a></li><li class="chapter-item expanded "><a href="../../ss/step_10/define_boxes.html"><strong aria-hidden="true">4.10.</strong> Collision 2: Define Boxes</a></li><li class="chapter-item expanded "><a href="../../ss/step_11/collide_boxes.html"><strong aria-hidden="true">4.11.</strong> Collision 3: Collide Boxes</a></li><li class="chapter-item expanded "><a href="../../ss/step_12/change_states.html"><strong aria-hidden="true">4.12.</strong> Change states</a></li><li class="chapter-item expanded "><a href="../../ss/step_13/game_over.html"><strong aria-hidden="true">4.13.</strong> Health, Game Over, Immortaility</a></li><li class="chapter-item expanded "><a href="../../ss/step_14/explosions.html"><strong aria-hidden="true">4.14.</strong> Explosions</a></li><li class="chapter-item expanded "><a href="../../ss/step_15/stars.html"><strong aria-hidden="true">4.15.</strong> Stars</a></li><li class="chapter-item expanded "><a href="../../ss/step_16/enemy_movement.html"><strong aria-hidden="true">4.16.</strong> Enemy Movement and Respawn</a></li></ol></li><li class="chapter-item expanded "><a href="../../resources/resources.html"><strong aria-hidden="true">5.</strong> Resources</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="bonus-step-unlimited-sprite-types"><a class="header" href="#bonus-step-unlimited-sprite-types">Bonus Step: Unlimited Sprite Types</a></h1>
<p>We have been using sprite flags to differentiate between the different sprite
types. This limits us to a maximum of 8 sprite types.</p>
<p>To overcome this limitation and support an unlimited number of sprite types,
we are going to switch from using sprite flags to explicitly enumerating all
of the sprites of each type.</p>
<p>In <code>map_setup</code>, we currently have this mapping of sprite types to their flags.</p>
<pre><code class="language-lua">wall=0
key=1
door=2
anim1=3
anim2=4
lose=6
win=7
</code></pre>
<p>Change each of these to be a list of all of the sprite numbers for each sprite
of that type. If you very closely followed along to this point, you should be
able to copy these values. If you were more casual in where you placed each
sprite type, your numbers will be different. Check each of these values against
your setup.</p>
<pre><code class="language-lua">wall={18,32,33,34,36,37,50,52}
key={20,36}
door={52}
anim1={23}
anim2={24}
lose={23}
win={7}
</code></pre>
<p>Replace the call to <code>fget</code> in <code>is_tile</code> in tab <code>1</code> with this:</p>
<pre><code class="language-lua">for i=1,#tile_type do
 if (tile == tile_type[i]) return true
end
return false
</code></pre>
<p>Once you have made these changes, hit <code>ctrl-s</code> to save your game and <code>ctrl-r</code>
to run it.</p>
<p>You will want to test to verify that all of the sprite types work. That means
you will want to:</p>
<ul>
<li>Attempt to walk into all wall tile types (e.g. water, wall)</li>
<li>Pick up all key tile types (e.g. the key and the chest)</li>
<li>Step on all spike tile types</li>
<li>Walk on all non-wall types (e.g. grass, stone)</li>
</ul>
<p>If a tile isn't behaving as you expect, double check that the number for the
sprite is in the correct list in <code>map_setup</code>.</p>
<h1 id="new-tile-type"><a class="header" href="#new-tile-type">New Tile Type</a></h1>
<p>Once you have verified all sprite types work, lets make use of the added
flexibility by adding a new sprite type.</p>
<p>We are going to change the chest so it gives us gold instead of a key. Modify
<code>map_setup</code>. Remove sprite <code>36</code> (the chest) from the key list.</p>
<pre><code class="language-lua">key={20}
</code></pre>
<p>and add it to a newly created <code>gold</code> list.</p>
<pre><code class="language-lua">gold={36}
</code></pre>
<p>Picking up gold does us no good, if we don't keep track of it. Lets modify
<code>make_player</code> in tab <code>2</code>. Put this at the end of the function.</p>
<pre><code class="language-lua">p.gold=0
</code></pre>
<p>With a place to store it, we can add a function to allow us to get it. Copy
<code>get_key</code> in tab <code>1</code> and modify it to create <code>get_gold</code>.</p>
<pre><code class="language-lua">function get_gold(x,y)
 p.gold+=5
 swap_tile(x,y)
 sfx(1)
end
</code></pre>
<pre><code class="language-lua">function interact(x,y)
 if (is_tile(key,x,y)) then
  get_key(x,y)
 elseif (is_tile(door,x,y) and...
  open_door(x,y)
 elseif (is_tile(gold,x,y))
  get_gold(x,y)
 end
</code></pre>
<p>Now we just need to update <code>show_inventory</code> in tab <code>3</code> to show the player how
much gold they have. Start by making the rectangle <code>6</code> pixels taller by changing
<code>invy+24</code> to <code>invy+30</code>. Then add this line to the end of the function.</p>
<pre><code class="language-lua">print(&quot;gold &quot;, .p.gold,invx+12, invy+20,9)
</code></pre>
<p>Save and run the game. The gold in the player's inventory should start out at
<code>0</code>. Open the chest and show the inventory. It should show <code>5</code> gold.</p>
<p>If you made it to this point, congratulations! You now have the ability to add
an unlimited number of sprite types. Here are just a few of the possibilities:</p>
<ul>
<li>Chests that hold specific items</li>
<li>Chests that hold a variable amount of gold</li>
<li>Keys that only open certain chests or doors</li>
<li>Items needed to complete quests</li>
<li>etc</li>
</ul>
<h1 id="result"><a class="header" href="#result">Result</a></h1>
<iframe width="750px" height="680px" src="./adventuregame_bonus_step_more_tiles.html"></iframe>
<a href="./adventuregame_bonus_step_more_tiles.p8.png" target="_blank">Download</a>
<h2 id="source-code"><a class="header" href="#source-code">Source Code</a></h2>
<p>Here is the full source code for this step. If you want your code to match what
is shown in the tutorial, everything after a <code>--&gt;8</code> line should go in a new
tab. This is not necessary, but failure to do so will make your code harder to
navigate, reason about, and edit.</p>
<p><strong>Note:</strong> The tool used to extract the full code listings does not properly
handle PICO-8's glyph characters. All glyph characters are replaced with an
<code>_</code>. You will need to manually replace them with the correct character.</p>
<pre><code class="language-lua">--adventure game
--by dylan

function _init()
 map_setup()
 make_player()
 
 game_win=false
 game_over=false
end

function _update()
 if (not game_over) then
  update_map()
  move_player()
  check_win_lose()
 else
  if (btnp(_)) extcmd(&quot;reset&quot;)
 end
end

function _draw()
 cls()
 if (not game_over) then
  draw_map()
  draw_player()
  if (btn(_)) show_inventory()
 else
  draw_win_lose()
 end
end


--&gt;8
--map code

function map_setup()
 --timers
 timer=0
 anim_time=30 --30 = 1 second

 --map tile settings
 wall={18,32,33,34,36,37,50,52}
 key={20}
 door={52}
 anim1={23}
 anim2={24}
 lose={23}
 win={7}
 gold={36}
end

function update_map()
 if (timer&lt;0) then
  toggle_tiles()
  timer=anim_time
 end
 timer-=1
end

function draw_map()
 mapx=flr(p.x/16)*16
 mapy=flr(p.y/16)*16
 camera(mapx*8,mapy*8)

 map(0,0,0,0,128,64)
end

function is_tile(tile_type,x,y)
 tile=mget(x,y)
 for i=1,#tile_type do
  if (tile==tile_type[i]) return true
 end
 return false
end

function can_move(x,y)
 return not is_tile(wall,x,y)
end

function swap_tile(x,y)
 tile=mget(x,y)
 mset(x,y,tile+1)
end

function unswap_tile(x,y)
 tile=mget(x,y)
 mset(x,y,tile-1)
end

function get_key(x,y)
 p.keys+=1
 swap_tile(x,y)
 sfx(1)
end

function open_door(x,y)
 p.keys-=1
 swap_tile(x,y)
 sfx(2)
end

function get_gold(x,y)
 p.gold+=5
 swap_tile(x,y)
 sfx(1)
end
--&gt;8
--player code

function make_player()
 p={}
 p.x=3
 p.y=2
 p.sprite=1
 p.keys=0
 p.gold=0
end

function draw_player()
 spr(p.sprite,p.x*8,p.y*8)
end

function move_player()
 newx=p.x
 newy=p.y
 
 if (btnp(_)) newx-=1
 if (btnp(_)) newx+=1
 if (btnp(_)) newy-=1
 if (btnp(_)) newy+=1
 
 interact(newx,newy)
 
 if (can_move(newx,newy)) then
  p.x=mid(0,newx,127)
  p.y=mid(0,newy,63)
 else
  sfx(0)
 end
end

function interact(x,y)
 if (is_tile(key,x,y)) then
  get_key(x,y)
 elseif (is_tile(door,x,y) and p.keys&gt;0) then
  open_door(x,y)
 elseif (is_tile(gold,x,y)) then
  get_gold(x,y)
 end
end
--&gt;8
--inventory code

function show_inventory()
 invx=mapx*8+40
 invy=mapy*8+8
 
 rectfill(invx,invy,invx+48,invy+30,0)
 print(&quot;inventory&quot;,invx+7,invy+4,7)
 print(&quot;keys &quot;..p.keys,invx+12,invy+14,9)
 print(&quot;gold &quot;..p.gold,invx+12,invy+20,9)
end
--&gt;8
--animation code

function toggle_tiles()
 for x=mapx,mapx+15 do
  for y=mapy,mapy+15 do
   if (is_tile(anim1,x,y)) then
    swap_tile(x,y)
    sfx(3)
   elseif (is_tile(anim2,x,y)) then
    unswap_tile(x,y)
    sfx(3)
   end
  end
 end
end
--&gt;8
--win/lose code

function check_win_lose()
 if (is_tile(win,p.x,p.y)) then
  game_win=true
  game_over=true
 elseif (is_tile(lose,p.x,p.y)) then
  game_win=false
  game_over=true
 end
end

function draw_win_lose()
 camera()
 if (game_win) then
  print(&quot;_ you win! _&quot;,37,64,7)
 else
  print(&quot;game over! :(&quot;,38,64,7)  
 end
 print(&quot;press _ to play again&quot;,20,72,5)
end
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../ag/step_11/bonus_adding_text.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../ss/intro/intro.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../ag/step_11/bonus_adding_text.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../ss/intro/intro.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            var socket = new WebSocket("ws://localhost:3000/__livereload");
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
