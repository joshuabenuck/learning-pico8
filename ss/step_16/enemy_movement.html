<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Enemy Movement and Respawn</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/custom.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../overview/overview.html">Overview</a></li><li class="chapter-item expanded "><a href="../../ag/intro/ag_tutorial.html"><strong aria-hidden="true">1.</strong> Adventure Game Tutorial</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../ag/step_01/the_map.html"><strong aria-hidden="true">1.1.</strong> The Map</a></li><li class="chapter-item expanded "><a href="../../ag/step_02/the_player.html"><strong aria-hidden="true">1.2.</strong> The Player</a></li><li class="chapter-item expanded "><a href="../../ag/step_03/movement.html"><strong aria-hidden="true">1.3.</strong> Movement</a></li><li class="chapter-item expanded "><a href="../../ag/step_04/camera.html"><strong aria-hidden="true">1.4.</strong> Camera</a></li><li class="chapter-item expanded "><a href="../../ag/step_05/keys.html"><strong aria-hidden="true">1.5.</strong> Keys</a></li><li class="chapter-item expanded "><a href="../../ag/step_06/inventory.html"><strong aria-hidden="true">1.6.</strong> Inventory</a></li><li class="chapter-item expanded "><a href="../../ag/step_07/doors.html"><strong aria-hidden="true">1.7.</strong> Doors</a></li><li class="chapter-item expanded "><a href="../../ag/step_08/animated_tiles.html"><strong aria-hidden="true">1.8.</strong> Animate Tiles</a></li><li class="chapter-item expanded "><a href="../../ag/step_09/winning_and_losing.html"><strong aria-hidden="true">1.9.</strong> Winning and Losing</a></li><li class="chapter-item expanded "><a href="../../ag/step_10/trying_again.html"><strong aria-hidden="true">1.10.</strong> Trying Again</a></li><li class="chapter-item expanded "><a href="../../ag/step_11/bonus_adding_text.html"><strong aria-hidden="true">1.11.</strong> Bonus Step: Adding Text</a></li><li class="chapter-item expanded "><a href="../../ag/step_12/bonus_unlimited_sprite_types.html"><strong aria-hidden="true">1.12.</strong> Bonus Step: Unlimited Sprite Types</a></li></ol></li><li class="chapter-item expanded "><a href="../../ss/intro/intro.html"><strong aria-hidden="true">2.</strong> A Space Shooter in 16 Steps</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../ss/step_01/draw_ship.html"><strong aria-hidden="true">2.1.</strong> Draw Ship on Screen</a></li><li class="chapter-item expanded "><a href="../../ss/step_02/animate_propulsion.html"><strong aria-hidden="true">2.2.</strong> Animate Propulsion</a></li><li class="chapter-item expanded "><a href="../../ss/step_03/ship_movement.html"><strong aria-hidden="true">2.3.</strong> Basic Ship Movement</a></li><li class="chapter-item expanded "><a href="../../ss/step_04/fire_bullets.html"><strong aria-hidden="true">2.4.</strong> Fire Laser Bullets</a></li><li class="chapter-item expanded "><a href="../../ss/step_05/remove_bullets.html"><strong aria-hidden="true">2.5.</strong> Remove Bullets</a></li><li class="chapter-item expanded "><a href="../../ss/step_06/draw_enemies.html"><strong aria-hidden="true">2.6.</strong> Draw Enemies</a></li><li class="chapter-item expanded "><a href="../../ss/step_07/move_enemies.html"><strong aria-hidden="true">2.7.</strong> Move Enemies</a></li><li class="chapter-item expanded "><a href="../../ss/step_08/points_and_health.html"><strong aria-hidden="true">2.8.</strong> Points and Health</a></li><li class="chapter-item expanded "><a href="../../ss/step_09/cleanup_and_prep.html"><strong aria-hidden="true">2.9.</strong> Collision 1: Cleanup and Prep</a></li><li class="chapter-item expanded "><a href="../../ss/step_10/define_boxes.html"><strong aria-hidden="true">2.10.</strong> Collision 2: Define Boxes</a></li><li class="chapter-item expanded "><a href="../../ss/step_11/collide_boxes.html"><strong aria-hidden="true">2.11.</strong> Collision 3: Collide Boxes</a></li><li class="chapter-item expanded "><a href="../../ss/step_12/change_states.html"><strong aria-hidden="true">2.12.</strong> Change states</a></li><li class="chapter-item expanded "><a href="../../ss/step_13/game_over.html"><strong aria-hidden="true">2.13.</strong> Health, Game Over, Immortaility</a></li><li class="chapter-item expanded "><a href="../../ss/step_14/explosions.html"><strong aria-hidden="true">2.14.</strong> Explosions</a></li><li class="chapter-item expanded "><a href="../../ss/step_15/stars.html"><strong aria-hidden="true">2.15.</strong> Stars</a></li><li class="chapter-item expanded "><a href="../../ss/step_16/enemy_movement.html" class="active"><strong aria-hidden="true">2.16.</strong> Enemy Movement and Respawn</a></li></ol></li><li class="chapter-item expanded "><a href="../../resources/resources.html"><strong aria-hidden="true">3.</strong> Resources</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="16-enemy-movement-and-respawn"><a class="header" href="#16-enemy-movement-and-respawn">16. Enemy Movement and Respawn</a></h1>
<video controls width="512" poster="./tut_16.gif">
    <source src="./tut_16.mp4"
            type="video/mp4">
    Sorry, your browser doesn't support embedded videos.
</video>
<p><a href="./tut_16.git">Image</a> (<a href="https://ztiromoritz.github.io/pico-8-shooter/gif/tut_16.gif">Original Source</a>)</p>
<p>The game as it stands now isn't very challenging. There are four enmeies. They
have a very predictable position and movement pattern. Once they are defeated,
no other enemies appear and you are left zooming through a star field with no
other threats.</p>
<p>In this, the final step of the original tutorial, we will add enemy respawn so
that once a wave of enemies is defeated or leaves the screen, another wave
takes their place.</p>
<p>Start by <em>deleting</em> the loop that creates the enemies out of <code>_init</code>. We are
going to move it elsewhere.</p>
<p>Create a <code>respawn</code> function just after <code>_init</code>.</p>
<pre><code class="language-lua">function respawn()
 local n=flr(rnd(9))+2
 for i=1,n do
  local d=-1
  if rnd(1)&lt;0.5 then d=1 end
  add(enemies, {
   sp=17,
   m_x=i*16,
   m_y=-20-i*8,
   d=d,
   x=-32
   y=-32
   r=12,
   box={x1=0,y1=0,x2=7,y2=7}
  })
 end
end
</code></pre>
<p>In <code>update_game</code>, add a check before the enemies loop to call <code>respawn</code> if
there are no more enemies. Modify the enemies loop to randomize their movement
patterns a bit and to remove enemies that have left the screen.</p>
<pre><code class="language-lua">if #enemies&lt;=0 then
 respawn()
end

for e in all(enemies) do
 e.m_y+=1.3
 e.x=e.r*sin(e.d*t/50)+e.m_x
 e.y=e.r*cos(t/50)+e.m_y
 if coll(ship,e) and not ship.emm then
  ship.imm=true
  ship.h-=1
  if ship.h&lt;=0 then
   game_over()
  end
 end

 if e.y&gt;150 then
  del(enemies,e)
 end
end
</code></pre>
<p>Hit <code>ctrl-r</code> to run the game. After defeating all of the enemies on the screen
or allowing them to go passed the ship off the bottom of the screen, more
enemies should take their place. Their movement patterns should be a bit
randomized and you fill finally be able to beat your high score of <code>4</code>!</p>
<div><img src="./result.png" width="512" /></div>
<p>Congratulations! You have completed all of the steps of the original &quot;Space Shooter in 16 GIFs&quot; tutorial!</p>
<p>The fun doesn't have to stop here! There are many things left that you could do. Here are some ideas to get you started.</p>
<ul>
<li>Can you move your ship off of the screen? What would it take to prevent this?</li>
<li>Bullets go straight through enemies. In many shooters, bullets are destroyed
by the impact with an enemy. How would you implement this?</li>
<li>In order to restart the game, we have to reset the cart? Write code to prompt
the user to press a button to restart and then reset the cart for them.
There's a PICO-8 API to reset the cart. Find the documentation for it!</li>
<li>Our game has no sound! Create sounds for firing a bullet, being hit, and
destroying an enemy. Play the sounds at the appropriate times.</li>
<li>Our game has no music! Write a catchy tune to keep you singing along while
you save the galaxy from the green invaders.</li>
<li>All of the enemies can be defeated with a single hit. What would you need to
change to make it take more than one hit to destroy an enemy?</li>
<li>We only have one enemy type! How would you add more?</li>
<li>All of the enemies follow the same movement pattern. What are some other
movement patterns? How would you implement them?</li>
<li>None of our enemies shoot bullets at us. How would you implement enemy
bullets? Should enemy bullets hurt other enemies? Why or why not? How would
you implement either approach?</li>
<li>The ship can never regain any hearts. How would you add power ups to allow
the ship to recover hearts?</li>
<li>Being able to recover hearts is nice. What other power ups should be in the
game? What do they do? How long do they last?</li>
<li>Speaking of power ups, what about upgrading your laser cannon or swapping it
out for an entirely different type of gun? What should the different weapon
types be? How do you change them? Do they randomly appear? Do you have to buy
them in a shop between levels?</li>
<li>Our game has no levels. How long should a level be? What should change from
level to level? Enemy speed, strength, type? What about visual changes?
Colors, obstacles, music?</li>
<li>Our game has no story. Should it have a general back story you see when you
first run the game? Or should the story unfold as you progress from level to
level? How would you implement your choice?</li>
<li>Even if a game has no story you directly tell the user, having a back story
for your game makes it easier to design things that fit into the game and
don't feel out of place. What is the back story for your game? How does that
story influence how you think about your game?</li>
<li>We have no high score list. How would you implement one?</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../ss/step_15/stars.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../resources/resources.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../ss/step_15/stars.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../resources/resources.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            var socket = new WebSocket("ws://localhost:3000/__livereload");
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
