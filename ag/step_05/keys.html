<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Keys</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/custom.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../overview/overview.html">Overview</a></li><li class="chapter-item expanded "><a href="../../ag/intro/ag_tutorial.html"><strong aria-hidden="true">1.</strong> Adventure Game Tutorial</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../ag/step_01/the_map.html"><strong aria-hidden="true">1.1.</strong> The Map</a></li><li class="chapter-item expanded "><a href="../../ag/step_02/the_player.html"><strong aria-hidden="true">1.2.</strong> The Player</a></li><li class="chapter-item expanded "><a href="../../ag/step_03/movement.html"><strong aria-hidden="true">1.3.</strong> Movement</a></li><li class="chapter-item expanded "><a href="../../ag/step_04/camera.html"><strong aria-hidden="true">1.4.</strong> Camera</a></li><li class="chapter-item expanded "><a href="../../ag/step_05/keys.html" class="active"><strong aria-hidden="true">1.5.</strong> Keys</a></li><li class="chapter-item expanded "><a href="../../ag/step_06/inventory.html"><strong aria-hidden="true">1.6.</strong> Inventory</a></li><li class="chapter-item expanded "><a href="../../ag/step_07/doors.html"><strong aria-hidden="true">1.7.</strong> Doors</a></li><li class="chapter-item expanded "><a href="../../ag/step_08/animated_tiles.html"><strong aria-hidden="true">1.8.</strong> Animate Tiles</a></li><li class="chapter-item expanded "><a href="../../ag/step_09/winning_and_losing.html"><strong aria-hidden="true">1.9.</strong> Winning and Losing</a></li><li class="chapter-item expanded "><a href="../../ag/step_10/trying_again.html"><strong aria-hidden="true">1.10.</strong> Trying Again</a></li><li class="chapter-item expanded "><a href="../../ag/step_11/bonus_adding_text.html"><strong aria-hidden="true">1.11.</strong> Bonus Step: Adding Text</a></li><li class="chapter-item expanded "><a href="../../ag/step_12/bonus_unlimited_sprite_types.html"><strong aria-hidden="true">1.12.</strong> Bonus Step: Unlimited Sprite Types</a></li></ol></li><li class="chapter-item expanded "><a href="../../ss/intro/intro.html"><strong aria-hidden="true">2.</strong> DRAFT: A Spaceshooter in 16 Steps</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../ss/step_01/draw_ship.html"><strong aria-hidden="true">2.1.</strong> Draw Ship on Screen</a></li><li class="chapter-item expanded "><a href="../../ss/step_02/animate_propulsion.html"><strong aria-hidden="true">2.2.</strong> Animate Propulsion</a></li><li class="chapter-item expanded "><a href="../../ss/step_03/ship_movement.html"><strong aria-hidden="true">2.3.</strong> Basic Ship Movement</a></li><li class="chapter-item expanded "><a href="../../ss/step_04/fire_bullets.html"><strong aria-hidden="true">2.4.</strong> Fire Laser Bullets</a></li><li class="chapter-item expanded "><a href="../../ss/step_05/remove_bullets.html"><strong aria-hidden="true">2.5.</strong> Remove Bullets</a></li><li class="chapter-item expanded "><a href="../../ss/step_06/draw_enemies.html"><strong aria-hidden="true">2.6.</strong> Draw Enemies</a></li><li class="chapter-item expanded "><a href="../../ss/step_07/move_enemies.html"><strong aria-hidden="true">2.7.</strong> Move Enemies</a></li><li class="chapter-item expanded "><a href="../../ss/step_08/points_and_health.html"><strong aria-hidden="true">2.8.</strong> Points and Health</a></li><li class="chapter-item expanded "><a href="../../ss/step_09/cleanup_and_prep.html"><strong aria-hidden="true">2.9.</strong> Collision 1: Cleanup and Prep</a></li><li class="chapter-item expanded "><a href="../../ss/step_10/define_boxes.html"><strong aria-hidden="true">2.10.</strong> Collision 2: Define Boxes</a></li><li class="chapter-item expanded "><a href="../../ss/step_11/collide_boxes.html"><strong aria-hidden="true">2.11.</strong> Collision 3: Collide Boxes</a></li><li class="chapter-item expanded "><a href="../../ss/step_12/change_states.html"><strong aria-hidden="true">2.12.</strong> Change states</a></li><li class="chapter-item expanded "><a href="../../ss/step_13/game_over.html"><strong aria-hidden="true">2.13.</strong> Health, Game Over, Immortaility</a></li><li class="chapter-item expanded "><a href="../../ss/step_14/explosions.html"><strong aria-hidden="true">2.14.</strong> Explosions</a></li><li class="chapter-item expanded "><a href="../../ss/step_15/stars.html"><strong aria-hidden="true">2.15.</strong> Stars</a></li><li class="chapter-item expanded "><a href="../../ss/step_16/enemy_movement.html"><strong aria-hidden="true">2.16.</strong> Enemy Movement and Respawn</a></li></ol></li><li class="chapter-item expanded "><a href="../../resources/resources.html"><strong aria-hidden="true">3.</strong> Resources</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="keys"><a class="header" href="#keys">Keys</a></h1>
<iframe width="560" height="315" src="https://www.youtube.com/embed/8RXnQYXufB8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>We are going to add items for our player to interact with in our world. One
will be a key they can pick up. The other will be a chest they can open.</p>
<p>You will need to draw two sprites for each of them.</p>
<p>For the key, the first will be what the key looks like when it can be picked
up. The second will be what the tile should look like after the key has been
picked up. In the example, it looks just like the grass tile.</p>
<p>You may ask, why not just reuse the grass tile? Why draw a duplicate? The
reason is that it greatly simplifies the code we have to write to handle
picking up keys.</p>
<p>Whenever the player interacts with a key tile in our world, we will simply
replace the sprite that received the interaction with the sprite immediately to
the right of it in the sprite sheet.</p>
<p>This means that it is <strong>very</strong> important that the tile without the key be
immediately to the right of the tile with the key!</p>
<p>Go ahead a draw the two key sprites now. You will want to set sprite flag 1 on
the key (but not the tile without the key). Sprite flag 1 is what we use to
determine if the player can interact with a tile.</p>
<p><img src="./key.png" alt="Key" /></p>
<p><img src="./key_picked_up.png" alt="Picked Up Key" /></p>
<p>For the chest, we need a sprite showing a closed chest and one showing an open
one. The closed chest needs to have sprite flag 1 set on it.</p>
<p>Just as with the key sprites, it is <strong>very</strong> important that the closed chest
sprite be immediately to the right of the open chest sprite.</p>
<p><img src="./chest.png" alt="Chest" /></p>
<p><img src="./chest_opened.png" alt="Chest Opened" /></p>
<p>Make a sound effect for the pick-up key sound.</p>
<p>Go to the sound editor. Switch from sound <code>00</code> to sound <code>01</code>. Try replicating
what is shown in the screenshot or feel free to make up your own sound.</p>
<p><img src="./pick_up_sound.png" alt="Pick Up Sound" /></p>
<p>Now we need to add the code that allows the player to pick up keys. Interacting
with either the key on the ground or the chest will give the player a key.</p>
<p>Add two functions, <code>swap_tile</code> and <code>get_key</code>, to the map code tab.</p>
<pre><code class="language-lua">function swap_tile(x,y)
 tile=mget(x,y)
 mset(x,y,tile+1)
end

function get_key(x,y)
 p.keys+=1
 swap_tile(x,y)
 sfx(1)
end
</code></pre>
<p>The <code>swap_tile</code> function replaces the current tile with the tile immediately to
the right of it in the sprite sheet. This is why we had to draw the key and
chest variants where we did.</p>
<p>The <code>get_key</code> function increases the count of the keys the player is carrying
by one, swaps the tile to show that the player successfully interacted with the
tile, and plays a sound to give an audible indication of the action.</p>
<p>Just adding these two functions changes nothing in our code. We have to call
one of them from somewhere.</p>
<p>Add a function called <code>interact</code> to the player code tab.</p>
<pre><code class="language-lua">function interact(x,y)
 if (is_tile(key,x,y)) then
  get_key(x,y)
 end
end
</code></pre>
<p>This function checks to see if the tile is a key tile. If it is, it calls the
<code>get_key</code> function to pick up the key.</p>
<p>Now call this function from the <code>move_player</code> function.</p>
<pre><code class="language-lua">function move_player()
 newx=p.x
 newy=p.y

 if (btnp(L)) newx-=1
 if (btnp(R)) newx+=1
 if (btnp(U)) newy-=1
 if (btnp(D)) newy+=1

 interact(newx,newy)
</code></pre>
<h2 id="end-result"><a class="header" href="#end-result">End Result</a></h2>
<p>Save your changes with <strong>ctrl+S</strong>. Run them with <strong>ctrl+R</strong>. You should now be
able to have your character pick up keys, but you will not be able to see how
many keys your character is holding. We will fix that in the next section.</p>
<iframe width="750px" height="680px" src="./adventuregame_step_05.html"></iframe>
<a href="./adventuregame_step_05.p8.png" target="_blank">Download</a>
<h2 id="source-code"><a class="header" href="#source-code">Source Code</a></h2>
<p>Here is the full source code for this step. If you want your code to match what
is shown in the tutorial, everything after a <code>--&gt;8</code> line should go in a new
tab. This is not necessary, but failure to do so will make your code harder to
navigate, reason about, and edit.</p>
<p><strong>Note:</strong> The tool used to extract the full code listings does not properly
handle PICO-8's glyph characters. All glyph characters are replaced with an
<code>_</code>. You will need to manually replace them with the correct character.</p>
<pre><code class="language-lua">--game loop

function _init()
 map_setup()
 make_player()
end

function _update()
 move_player()
end

function _draw()
 cls()
 draw_map()
 draw_player()
end


--&gt;8
--map code

function map_setup()
 --map tile settings
 wall=0
 key=1
 door=2
 anim1=3
 anim2=4
 lose=6
 win=7
end

function draw_map()
 mapx=flr(p.x/16)*16
 mapy=flr(p.y/16)*16
 camera(mapx*8,mapy*8)

 map(0,0,0,0,128,64)
end

function is_tile(tile_type,x,y)
 tile=mget(x,y)
 has_flag=fget(tile,tile_type)
 return has_flag
end

function can_move(x,y)
 return not is_tile(wall,x,y)
end

function swap_tile(x,y)
 tile=mget(x,y)
 mset(x,y,tile+1)
end

function get_key(x,y)
 p.keys+=1
 swap_tile(x,y)
 sfx(1)
end
--&gt;8
--player code

function make_player()
 p={}
 p.x=3
 p.y=2
 p.sprite=1
 p.keys=0
end

function draw_player()
 spr(p.sprite,p.x*8,p.y*8)
end

function move_player()
 newx=p.x
 newy=p.y
 
 if (btnp(_)) newx-=1
 if (btnp(_)) newx+=1
 if (btnp(_)) newy-=1
 if (btnp(_)) newy+=1
 
 interact(newx,newy)
 
 if (can_move(newx,newy)) then
  p.x=mid(0,newx,127)
  p.y=mid(0,newy,63)
 else
  sfx(0)
 end
end

function interact(x,y)
 if (is_tile(key,x,y)) then
  get_key(x,y)
 end
end
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../ag/step_04/camera.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../ag/step_06/inventory.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../ag/step_04/camera.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../ag/step_06/inventory.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            var socket = new WebSocket("ws://localhost:3000/__livereload");
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
